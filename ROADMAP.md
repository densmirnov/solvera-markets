# ROADMAP — путь к опубликованному MVP

## Ключевые принципы
- Код покрыт тестами для минимизации ошибок.
- Любые изменения в коде фиксируются в документации.
- Все проверки и валидации выполняются до релиза.

## Факты / выводы / гипотезы
- Факты: scope MVP, роли, state machine, экономика, функции контракта — см. `docs/`.
- Вывод: для релиза нужны независимые контуры — контракт, индексатор, backend, frontend, CI/CD, публикация и валидация.
- Гипотеза: MVP целесообразно развернуть сначала в тестовой сети, затем в основной сети. Неподтверждено, зависит от стратегии проекта.

## Зависимости (общее правило)
- Каждая задача имеет входные артефакты и проверку готовности.
- Блок «Проверка» закрывает задачу и разблокирует зависимые.

---

## Этап 0. Базовая организация репозитория

### 0.1 Стандартизировать структуру проекта
- Задача: определить и зафиксировать каталоги: `contracts/`, `indexer/`, `backend/`, `frontend/`, `docs/`, `scripts/`, `tests/`.
- Зависимости: нет.
- Проверка: структура каталогов создана, в `docs/README.md` добавлена навигация.

### 0.2 Политика документации
- Задача: ввести правило «каждое изменение в коде сопровождается обновлением документации».
- Зависимости: 0.1.
- Проверка: правило описано в `docs/README.md` и `CONTRIBUTING.md`.

### 0.3 Базовые инструменты качества
- Задача: выбрать и настроить единые инструменты форматирования, линтинга и тестов для всех подпроектов.
- Зависимости: 0.1.
- Проверка: есть единый `make`/`task`/`npm`/`pnpm` entrypoint с проверками.

### 0.4 Инженерные стандарты
- Задача: закрепить обязательное использование линтеров и автофиксаторов для всего кода.
- Зависимости: 0.3.
- Проверка: правила отражены в `CONTRIBUTING.md` и `docs/20-engineering-standards.md`.

---

## Этап 1. Контракты (MVP)

### 1.1 Спецификация ABI и событий
- Задача: зафиксировать ABI и payload схемы событий.
- Зависимости: 0.1.
- Проверка: опубликован документ `docs/12-abi-events.md`.

### 1.2 Реализация контракта
- Задача: реализовать функции `createIntent`, `submitOffer`, `selectWinner`, `fulfill`, `_accept`, `expire`, хранение state и параметров.
- Зависимости: 1.1.
- Проверка: контракт компилируется, ABI соответствует документации.

### 1.3 Экономика и репутация
- Задача: реализовать fee‑механику, bond, `rep`.
- Зависимости: 1.2.
- Проверка: unit‑тесты покрывают все ветки экономики.

### 1.4 Инварианты и тест‑набор
- Задача: реализовать сценарные тесты и property/invariant тесты.
- Зависимости: 1.2.
- Проверка: все тесты проходят в CI и локально.

### 1.5 Статический анализ и аудит‑готовность
- Задача: статический анализ (slither/solhint), чек‑лист аудита, документ угроз.
- Зависимости: 1.2.
- Проверка: отчёт проверок сохранён в `docs/`.

### 1.6 Деплой в тестовую сеть
- Задача: деплой контракта и запись адреса/chainId.
- Зависимости: 1.4.
- Проверка: транзакции доступны в обозревателе, адреса сохранены в `docs/13-deployments.md`.

### 1.7 Верификация контракта
- Задача: верифицировать исходники в обозревателе.
- Зависимости: 1.6.
- Проверка: контракт полностью верифицирован.

### 1.8 Деплой в основную сеть
- Задача: деплой в Base mainnet (или выбранную сеть).
- Зависимости: 1.7, 2.4, 3.4, 4.3.
- Проверка: адреса и версии сохранены, верификация успешна.

---

## Этап 2. Индексатор

### 2.1 Модель данных
- Задача: описать сущности (Intent, Offer, Winner, Reputation, EventLog).
- Зависимости: 1.1.
- Проверка: схема описана в `docs/14-indexer-model.md`.

### 2.2 Реализация индексатора
- Задача: парсинг событий и построение состояния.
- Зависимости: 2.1, 1.6.
- Проверка: локальный прогон на тестовой сети, корректные агрегаты.

### 2.3 Валидация данных
- Задача: проверка консистентности, дедупликация, idempotency.
- Зависимости: 2.2.
- Проверка: тест‑набор для edge‑кейсов событий.

### 2.4 Публикация индексатора
- Задача: развернуть индексатор (self‑hosted или managed).
- Зависимости: 2.3.
- Проверка: SLA/health‑endpoint и мониторинг.

---

## Этап 3. Backend (API)

### 3.1 Контракт API
- Задача: определить API для чтения интентов, офферов, статусов и репутации.
- Зависимости: 2.1.
- Проверка: спецификация `docs/15-backend-api.md`.

### 3.2 Реализация backend
- Задача: REST/GraphQL слой над индексатором.
- Зависимости: 3.1, 2.4.
- Проверка: интеграционные тесты API.

### 3.3 Безопасность и лимиты
- Задача: rate‑limits, ключи доступа, защита от abuse.
- Зависимости: 3.2.
- Проверка: тесты лимитов и политики доступа.

### 3.4 Публикация backend
- Задача: деплой backend, настройка доменов/сертификатов.
- Зависимости: 3.3.
- Проверка: prod healthcheck, мониторинг и алерты.

---

## Этап 4. Frontend (минимальный для верификации)

### 4.1 Минимальные экраны
- Задача: список интентов, детали интента, статусы.
- Зависимости: 3.2.
- Проверка: данные соответствуют backend.

### 4.2 Инструменты для операторов
- Задача: простые инструменты просмотра событий и состояния.
- Зависимости: 4.1.
- Проверка: корректная визуализация state machine.

### 4.3 Публикация frontend
- Задача: деплой (CDN/Pages), базовая аналитика.
- Зависимости: 4.2.
- Проверка: доступность и стабильность в проде.

---

## Этап 5. CI/CD и релизный контур

### 5.1 CI пайплайн
- Задача: автоматический запуск тестов для контрактов, индексатора, backend, frontend.
- Зависимости: 1.4, 2.3, 3.2, 4.2.
- Проверка: все проверки проходят на каждом PR.

### 5.1a Докеризация и Dokploy
- Задача: проект поднимается одной командой `docker compose up`.
- Зависимости: 0.4.
- Проверка: `docker-compose.yml` собирает и запускает сервисы без ручных шагов.

### 5.1b Dokploy pipeline
- Задача: деплой через автоматическую сборку из GitHub в Dokploy.
- Зависимости: 5.1a.
- Проверка: Dokploy успешно строит и запускает сервисы из репозитория.

### 5.2 Политика релизов
- Задача: версия релиза, changelog, тегирование.
- Зависимости: 5.1.
- Проверка: релизный процесс описан в `docs/16-release-process.md`.

### 5.3 Предрелизная валидация
- Задача: повторяемая проверка по чек‑листу (контракт, индексатор, backend, frontend).
- Зависимости: 5.2.
- Проверка: чек‑лист выполнен и подписан.

---

## Этап 6. Финальный релиз MVP

### 6.1 Комплексное тестирование
- Задача: интеграционное тестирование end‑to‑end.
- Зависимости: 1.8, 2.4, 3.4, 4.3.
- Проверка: отчёт E2E в `docs/17-e2e-report.md`.

### 6.2 Публикация MVP
- Задача: объявление релиза, публикация адресов контрактов, API и ссылок.
- Зависимости: 6.1.
- Проверка: `docs/13-deployments.md` и `docs/16-release-process.md` обновлены.

### 6.3 Мониторинг и пост‑релиз
- Задача: метрики SLA, ошибки, отклонения инвариантов.
- Зависимости: 6.2.
- Проверка: мониторинг активен, алерты настроены.

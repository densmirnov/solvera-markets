# Intent Marketplace — PRD v0.1 (MVP / Этап 1)

## 0. Статус документа
- Тип: Product Requirements Document (Implementation-ready)
- Версия: v0.1
- Этап: 1 — On-chain Outcome Market (transfer-only)
- Основание: PRD v0 (Vision & Phased Roadmap)
- Цель: зафиксировать точный scope MVP для начала разработки

---

## 1. Цель MVP

Создать **он-чейн рынок доставки результатов** для AI-агентов, в котором:
- инициатор публикует формализованный запрос на получение ончейн-актива,
- исполнители (solver-агенты) конкурируют, предлагая лучший результат,
- победитель получает вознаграждение **только при фактической доставке результата**,
- ответственность и расчёт обеспечиваются через escrow, TTL и репутацию,
- вся система работает **без calldata, без кроссчейна, без арбитража**.

MVP должен быть пригоден для реального использования агентами без ручного участия человека.

---

## 2. In-scope / Out-of-scope

### 2.1 In-scope (обязательно)
- Single-chain (одна сеть)
- Transfer-only интенты (проверка по факту получения токенов)
- Escrow вознаграждения
- Конкурентные офферы solver-ов
- Выбор победителя verifier-агентом
- TTL и авто-рефанд
- Репутация solver-ов (+1 / -1)
- Минимальный bond победителя (liveness)
- Event-based API для SDK

### 2.2 Out-of-scope (запрещено в MVP)
- Кроссчейн settlement
- Calldata / execution intents
- Off-chain deliverables
- Ончейн-арбитраж
- UI для людей
- Универсальные интенты

---

## 3. Ключевые пользовательские сценарии (agent-first)

### Сценарий 1: Успешная доставка
1. Initiator-agent создаёт интент: «получи ≥ X токенов A».
2. Solver-агенты публикуют офферы (числовые значения).
3. Verifier-агент выбирает победителя.
4. Победитель доставляет токены в контракт.
5. Контракт пересылает токены инициатору.
6. Контракт выплачивает reward solver-у.
7. Репутация solver-а увеличивается.

### Сценарий 2: Победитель не исполняет
1. Победитель выбран, но не доставляет результат до ttlAccept.
2. Любой агент вызывает expire.
3. Победитель получает -1 к репутации и/или теряет bond.
4. Интент возвращается в OPEN или завершается.

### Сценарий 3: Нет подходящих офферов
1. Интент истекает по ttlSubmit.
2. Reward возвращается payer-у за вычетом комиссии.

---

## 4. Тип интента (MVP)

### 4.1 IntentKind
- `TRANSFER_OUTCOME`

### 4.2 Параметры интента
- `tokenOut` — адрес ERC-20 токена
- `minAmountOut` — минимально допустимое количество
- `rewardToken` — токен вознаграждения
- `rewardAmount`
- `payer`
- `initiator`
- `verifier`
- `ttlSubmit`
- `ttlAccept`

---

## 5. Роли и полномочия

- **Payer**: лочит reward, получает рефанд
- **Initiator**: владелец интента
- **Verifier (agent)**:
  - выбирает победителя
  - подписывает ACCEPT / REJECT
- **Solver**:
  - подаёт офферы
  - исполняет доставку

---

## 6. State Machine (MVP)

Состояния:
1. `OPEN` — приём офферов
2. `SELECTED` — выбран победитель
3. `FULFILLED` — результат доставлен
4. `ACCEPTED` — выплата выполнена
5. `EXPIRED` — завершён по таймауту

Переходы:
- OPEN → SELECTED
- SELECTED → FULFILLED
- FULFILLED → ACCEPTED
- OPEN → EXPIRED
- SELECTED → EXPIRED

---

## 7. Офферы solver-ов

### 7.1 Формат оффера
- `solver`
- `amountOut`
- `timestamp`

Хранятся ончейн или оффчейн (MVP: onchain storage допустим).

---

## 8. Выбор победителя

- Выполняется verifier-агентом
- Фиксирует solver и amountOut
- Запускает ttlAccept
- Может требовать bond от победителя

---

## 9. Выполнение (fulfill)

- Вызывается победителем
- Solver переводит `amountOut` токенов в контракт
- Контракт проверяет `amountOut >= minAmountOut`
- Контракт пересылает токены инициатору
- Контракт фиксирует FULFILLED

---

## 10. Acceptance и расчёт

- Для MVP acceptance может быть implicit (после fulfill)
- Контракт:
  - выплачивает reward solver-у
  - увеличивает репутацию solver-а (+1)

---

## 11. Таймауты и slashing

- `ttlSubmit`:
  - если истёк и нет победителя → EXPIRED + refund
- `ttlAccept`:
  - если истёк и нет fulfill → EXPIRED + penalty solver-у

Penalty:
- -1 к репутации
- (опционально) потеря bond

---

## 12. Репутация (MVP)

- Хранится on-chain как счётчик
- +1 при ACCEPTED
- -1 при winner expiration

---

## 13. Экономика MVP

- Reward escrow
- Платформа удерживает комиссию (фикс %)
- Bond победителя (небольшой, возвращаемый при успехе)

---

## 14. Метрики успеха MVP

- Количество созданных интентов
- % интентов с успешным fulfill
- Среднее время до fulfill
- Количество активных solver-агентов

---

## 15. Нефункциональные требования

- Минимальный gas footprint
- Простая модель хранения
- Детерминированное поведение
- Совместимость с agent SDK

---

## 16. Риски MVP

1. Низкая ликвидность solver-ов
2. Спам офферами
3. Саботаж победителей

Митигируются через TTL, bond, репутацию.

---

## 17. Готовность к следующему этапу

PRD v0.1 считается выполненным, если:
- MVP стабильно обслуживает transfer-only интенты
- API используется агентами без ручного контроля
- Архитектура допускает добавление calldata и acceptance receipts без рефакторинга ядра

